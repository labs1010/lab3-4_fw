(()=>{"use strict";class e{static getInstance(){return this._instance||(this._instance=new e),this._instance}constructor(){document.querySelector(".modal").style.backgroundColor="rgba(0, 0, 0, 0.5)"}show(e){const t=document.querySelector(".modal"),s=document.createElement("div");s.className="modal-content";const o=document.createElement("div");o.className="modal-dialog modal-dialog-centerd";const a=document.createElement("div");a.className="modal-body",a.textContent=e;const r=document.createElement("div");r.className="modal-footer";const n=document.createElement("button");n.type="button",n.className="btn btn-primary",n.addEventListener("click",this.hide);const i=document.createElement("img");i.src="assets/pon.gif",i.alt="Pon",i.className="w-100 img-fluid",n.appendChild(i),r.appendChild(n),s.appendChild(a),s.appendChild(r),o.appendChild(s),t.innerHTML="",t.appendChild(o),this.appear()}askId(){const e=document.querySelector(".modal"),t=document.createElement("div");t.className="modal-dialog modal-dialog-centered";const s=document.createElement("div");s.className="modal-content";const o=document.createElement("div");o.className="modal-header";const a=document.createElement("h5");a.className="modal-title",a.textContent="Введіть ID користувача для позичення книги:";const r=document.createElement("button");r.type="button",r.className="btn-close",r.setAttribute("data-bs-dismiss","modal"),r.setAttribute("aria-label","Close"),r.addEventListener("click",this.hide),o.appendChild(a),o.appendChild(r);const n=document.createElement("form");n.className="needs-validation",n.noValidate=!0,n.name="borrow-form",n.id="borrow-form";const i=document.createElement("div");i.className="modal-body";const d=document.createElement("input");d.type="text",d.className="form-control",d.pattern="\\d+",d.placeholder="ID",d.required=!0,i.appendChild(d);const c=document.createElement("div");c.className="modal-footer";const l=document.createElement("button");l.type="button",l.className="btn btn-secondary",l.setAttribute("data-bs-dismiss","modal"),l.textContent="Скасувати",l.addEventListener("click",this.hide);const m=document.createElement("button");m.type="submit",m.className="btn btn-primary",m.textContent="Зберегти",c.appendChild(l),c.appendChild(m),n.appendChild(i),n.appendChild(c),s.appendChild(o),s.appendChild(n),t.appendChild(s),e.innerHTML="",e.appendChild(t),this.appear()}appear(){const e=document.querySelector(".modal");e.classList.add("show"),document.body.classList.add("modal-open"),e.style.display="block",e.ariaHidden="false",e.ariaModal="true",e.role="dialog"}hide(){const e=document.querySelector(".modal");e.classList.remove("show"),e.style.display="none",document.body.classList.remove("modal-open"),e.ariaHidden="true",e.ariaModal="false",e.role=""}}class t{constructor(e,t,s,o){this.borrower=0,this.id=e,this.name=t,this.author=s,this.releaseYear=o}get getId(){return this.id}get getName(){return this.name}get getAuthor(){return this.author}get getReleaseYear(){return this.releaseYear}get getBorrower(){return this.borrower}isBorrowed(){return 0!=this.borrower}borrow(e){this.borrower=e}return(){this.borrower=0}}class s{constructor(e,t,s){this.borrowedBooks=0,this.id=e,this.name=t,this.email=s}get getId(){return this.id}get getName(){return this.name}get getEmail(){return this.email}borrowBook(e){return!(this.borrowedBooks>3||e.isBorrowed()||(this.borrowedBooks++,e.borrow(this.id),0))}returnBook(){return this.borrowedBooks>0&&(this.borrowedBooks--,!0)}}class o{constructor(e=[]){this._objects=e}get(){return this._objects}add(e){this._objects.push(e)}remove(e){if(null!=e){const t=this._objects.indexOf(e);if(-1===t)return;this._objects.splice(t,1)}}update(e,t){if(null!=e){const s=this._objects.indexOf(e);if(-1===s)return;this._objects[s]=t}}search(e){return this._objects.find(e)}}class a{static set(e,t){localStorage.setItem(e,t)}static get(e){return localStorage.getItem(e)}static remove(e){localStorage.removeItem(e)}static clear(){localStorage.clear()}}class r{static getInstance(){return this._instance||(this._instance=new r),this._instance}constructor(){var e,t;const s=JSON.parse(null!==(e=a.get("books"))&&void 0!==e?e:"[]"),r=JSON.parse(null!==(t=a.get("users"))&&void 0!==t?t:"[]");Array.isArray(s)&&Array.isArray(r)?(console.log("Data loaded from storage"),this._books=new o(s),this._users=new o(r)):(console.log("No data in storage, initializing empty library"),a.clear(),this._books=new o,this._users=new o),window.addEventListener("beforeunload",()=>{a.set("books",JSON.stringify(this._books.get())),a.set("users",JSON.stringify(this._users.get()))})}getBooks(){return this._books.get()}getUsers(){return this._users.get()}addBook(e){this._books.add(e)}addUser(e){this._users.add(e)}removeBook(e){this._books.remove(this._books.search(t=>t.getName===e))}removeUser(e){this._users.remove(this._users.search(t=>t.getId===e))}updateBook(e,t){const s=this._books.search(t=>t.getId===e);this._books.update(s,t)}updateUser(e,t){const s=this._users.search(t=>t.getId===e);this._users.update(s,t)}findBook(e){return this._books.search(t=>t.getName===e)}findUser(e){return this._users.search(t=>t.getId===e)}}class n{static getInstance(){return this._instance||(this._instance=new n),this._instance}validateForm(e){return!!e.reportValidity()&&(e.classList.add("was-validated"),!0)}}class i{constructor(){this._validation=n.getInstance(),this._service=r.getInstance(),this._modal=e.getInstance(),this.updateUI();const o=document.forms.namedItem("add-book"),a=document.forms.namedItem("add-user");o.addEventListener("submit",e=>{if(e.preventDefault(),this._validation.validateForm(o)){const e=Date.now(),s=o["book-name"].value,a=o["book-author"].value,r=parseInt(o["release-year"].value),n=new t(e,s,a,r);this._service.addBook(n),o.reset(),o.classList.remove("was-validated"),this.updateUI()}}),a.addEventListener("submit",e=>{if(e.preventDefault(),this._validation.validateForm(a)){const e=a["user-name"].value,t=a["user-email"].value,o=Date.now(),r=new s(o,e,t);this._service.addUser(r),a.reset(),a.classList.remove("was-validated"),this.updateUI()}})}updateUI(){const e=e=>{const o=this._service.getUsers().find(t=>t.getId===e.getBorrower);Object.setPrototypeOf(e,t.prototype),Object.setPrototypeOf(o,s.prototype),o&&o.returnBook()&&e.isBorrowed()?(e.return(),this._service.updateBook(e.getId,e),this._service.updateUser(o.getId,o),this._modal.show(`${e.getName} by ${e.getAuthor} (${e.getReleaseYear}) успішно повернена користувачем ${o.getId} ${o.getName} (${o.getEmail}).`),this.updateUI()):this._modal.show("Не вдалося повернути книгу.")},o=e=>{this._modal.askId();const o=document.getElementById("borrow-form");null==o||o.addEventListener("submit",o=>{o.preventDefault(),console.log("e");const a=o.target;if(this._validation.validateForm(a)){const o=parseInt(a[0].value),r=this._service.findUser(o);r?(Object.setPrototypeOf(e,t.prototype),Object.setPrototypeOf(r,s.prototype),r&&r.borrowBook(e)?(console.log("e"),this._service.updateBook(e.getId,e),this._service.updateUser(r.getId,r),this._modal.show(`${e.getName} by ${e.getAuthor} (${e.getReleaseYear}) успішно позичена користувачем ${r.getId} ${r.getName} (${r.getEmail}).`),this.updateUI()):(console.log("e"),this._modal.show("Не вдалося позичити книгу. Можливо, користувач досяг ліміту позичених книг або книга вже позичена."))):this._modal.show("Не вдалося знайти користувача")}})},a=document.getElementById("book-list");a.innerHTML="",this._service.getBooks().forEach(s=>{Object.setPrototypeOf(s,t.prototype);const r=document.createElement("div");r.className="d-flex justify-content-between align-items-center border-bottom py-3";const n=document.createElement("span");n.textContent=`${s.getName} by ${s.getAuthor} (${s.getReleaseYear})`;const i=document.createElement("button");i.className=s.isBorrowed()?"btn btn-warning":"btn btn-primary",i.type="button",i.textContent=s.isBorrowed()?"Повернути":"Позичити",s.isBorrowed()?i.addEventListener("click",()=>e(s)):i.addEventListener("click",()=>o(s)),r.appendChild(n),r.appendChild(i),a.appendChild(r)});const r=document.getElementById("user-list");r.innerHTML="",this._service.getUsers().forEach(e=>{Object.setPrototypeOf(e,s.prototype),r.innerHTML+=`\n                <div class="d-flex align-items-center py-3 border-bottom">\n                    <span>${e.getId} ${e.getName} (${e.getEmail})</span>\n                </div>\n            `})}}document.addEventListener("DOMContentLoaded",()=>{new i})})();
//# sourceMappingURL=bundle.js.map